# ุฑุงูููุง ุชุณุช ูุงฺูู Invoices

ุงู ุฑุงูููุง ูุฑุงุญู ุชุณุช ูุงฺูู Invoices ุฑุง ุชูุถุญ ูโุฏูุฏ.

## โ ฺฉุงุฑูุง ุงูุฌุงู ุดุฏู

1. โ **Service ฺฉุงูู** (`lib/services/invoices.service.ts`)
   - `createInvoice()` - ุงุฌุงุฏ ูพุดโูุงฺฉุชูุฑ
   - `updateInvoice()` - ุจูโุฑูุฒุฑุณุงู ูพุดโูุงฺฉุชูุฑ
   - `calculateInvoiceTotal()` - ูุญุงุณุจู ุฎูุฏฺฉุงุฑ ูุจุงูุบ
   - `listInvoices()` - ูุณุช ุจุง ููุชุฑ ู Pagination
   - `getInvoiceById()` - ุฏุฑุงูุช ุฌุฒุฆุงุช
   - `changeInvoiceStatus()` - ุชุบุฑ ูุถุนุช
   - `markInvoiceAsPaid()` - ุนูุงูุชโฺฏุฐุงุฑ ุจู ุนููุงู ูพุฑุฏุงุฎุช ุดุฏู
   - `deleteInvoice()` - ุญุฐู

2. โ **API Endpoints**
   - `GET /api/invoices` - ูุณุช ูพุดโูุงฺฉุชูุฑูุง
   - `POST /api/invoices` - ุงุฌุงุฏ ูพุดโูุงฺฉุชูุฑ
   - `GET /api/invoices/[id]` - ุฌุฒุฆุงุช ูพุดโูุงฺฉุชูุฑ
   - `PATCH /api/invoices/[id]` - ุจูโุฑูุฒุฑุณุงู
   - `DELETE /api/invoices/[id]` - ุญุฐู
   - `PATCH /api/invoices/[id]/status` - ุชุบุฑ ูุถุนุช
   - `GET /api/invoices/[id]/pdf` - ุฏุงูููุฏ PDF

3. โ **PDF Generation** (`lib/utils/pdf-generator.ts`)
   - ุชููุฏ PDF ุจุง pdfkit
   - ูุฑูุช ูุงุฑุณ ุจุฑุง ุชุงุฑุฎ ู ุงุนุฏุงุฏ
   - ููุงุด ฺฉุงูู ุงุทูุงุนุงุช ูพุดโูุงฺฉุชูุฑ

---

## ๐งช ูุฑุงุญู ุชุณุช

### ูุฑุญูู 1: ุชุณุช API ุจุง Postman

#### 1.1. ุฏุฑุงูุช ูุณุช ูพุดโูุงฺฉุชูุฑูุง

**Request:**
```
GET http://localhost:3000/api/invoices
Headers:
  Authorization: Bearer {YOUR_JWT_TOKEN}
```

**Query Parameters (ุงุฎุชุงุฑ):**
- `status`: DRAFT, SENT, PAID, OVERDUE, CANCELLED
- `customerId`: ุดูุงุณู ูุดุชุฑ
- `marketerId`: ุดูุงุณู ุจุงุฒุงุฑุงุจ
- `startDate`: ุชุงุฑุฎ ุดุฑูุน (ISO format)
- `endDate`: ุชุงุฑุฎ ูพุงุงู (ISO format)
- `page`: ุดูุงุฑู ุตูุญู (ูพุดโูุฑุถ: 1)
- `limit`: ุชุนุฏุงุฏ ุฏุฑ ูุฑ ุตูุญู (ูพุดโูุฑุถ: 20)

**Response (ูููู):**
```json
{
  "success": true,
  "data": {
    "data": [],
    "total": 0,
    "page": 1,
    "limit": 20
  }
}
```

---

#### 1.2. ุงุฌุงุฏ ูพุดโูุงฺฉุชูุฑ ุฌุฏุฏ

**Request:**
```
POST http://localhost:3000/api/invoices
Headers:
  Authorization: Bearer {YOUR_JWT_TOKEN}
  Content-Type: application/json
```

**Body:**
```json
{
  "customerId": "CUSTOMER_ID_HERE",
  "marketerId": "MARKETER_ID_HERE",
  "status": "DRAFT",
  "issuedAt": "2024-01-15T10:00:00.000Z",
  "dueAt": "2024-01-22T10:00:00.000Z",
  "currency": "IRR",
  "items": [
    {
      "title": "ุณุฑูุณ ุฏูุฑูโุง ุชุฌูุฒุงุช",
      "quantity": 1,
      "unit": "ุจุณุชู",
      "unitPrice": 18000000,
      "taxRate": 9,
      "discount": 0
    },
    {
      "title": "ูุทุนุงุช ูุตุฑู ูุงูุงูู",
      "quantity": 6,
      "unit": "ุนุฏุฏ",
      "unitPrice": 2500000,
      "taxRate": 9,
      "discount": 0
    }
  ],
  "paymentReference": null
}
```

**Response (ูููู):**
```json
{
  "success": true,
  "message": "ูพุดโูุงฺฉุชูุฑ ุจุง ููููุช ุงุฌุงุฏ ุดุฏ.",
  "data": {
    "_id": "INVOICE_ID",
    "customerId": "CUSTOMER_ID",
    "status": "DRAFT",
    "subtotal": 33000000,
    "taxTotal": 2970000,
    "discountTotal": 0,
    "grandTotal": 35970000,
    "items": [...],
    "meta": {
      "invoiceNumber": "INV-202401-1234"
    }
  }
}
```

**ูฺฉุงุช ููู:**
- `customerId` ุจุงุฏ ฺฉ ุดูุงุณู ูุนุชุจุฑ ุงุฒ ุฌุฏูู Customers ุจุงุดุฏ
- `marketerId` ุงุฎุชุงุฑ ุงุณุช
- `items` ุจุงุฏ ุญุฏุงูู ฺฉ ุขุชู ุฏุงุดุชู ุจุงุดุฏ
- ูุจุงูุบ ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ูุญุงุณุจู ูโุดููุฏ

---

#### 1.3. ุฏุฑุงูุช ุฌุฒุฆุงุช ูพุดโูุงฺฉุชูุฑ

**Request:**
```
GET http://localhost:3000/api/invoices/{INVOICE_ID}
Headers:
  Authorization: Bearer {YOUR_JWT_TOKEN}
```

**Response (ูููู):**
```json
{
  "success": true,
  "data": {
    "_id": "INVOICE_ID",
    "customerId": "CUSTOMER_ID",
    "customerName": "ูุงู ูุดุชุฑ",
    "status": "DRAFT",
    "items": [...],
    "grandTotal": 35970000,
    ...
  }
}
```

---

#### 1.4. ุจูโุฑูุฒุฑุณุงู ูพุดโูุงฺฉุชูุฑ

**Request:**
```
PATCH http://localhost:3000/api/invoices/{INVOICE_ID}
Headers:
  Authorization: Bearer {YOUR_JWT_TOKEN}
  Content-Type: application/json
```

**Body (ููุท ููุฏูุง ููุฑุฏ ูุงุฒ):**
```json
{
  "status": "SENT",
  "items": [
    {
      "title": "ุณุฑูุณ ุฏูุฑูโุง ุชุฌูุฒุงุช",
      "quantity": 2,
      "unit": "ุจุณุชู",
      "unitPrice": 18000000,
      "taxRate": 9,
      "discount": 1000000
    }
  ]
}
```

**ูฺฉุชู:** ุฏุฑ ุตูุฑุช ุชุบุฑ `items`ุ ูุจุงูุบ ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ุฏูุจุงุฑู ูุญุงุณุจู ูโุดููุฏ.

---

#### 1.5. ุชุบุฑ ูุถุนุช ูพุดโูุงฺฉุชูุฑ

**Request:**
```
PATCH http://localhost:3000/api/invoices/{INVOICE_ID}/status
Headers:
  Authorization: Bearer {YOUR_JWT_TOKEN}
  Content-Type: application/json
```

**Body:**
```json
{
  "status": "PAID",
  "paidAt": "2024-01-20T10:00:00.000Z"
}
```

**ูุถุนุชโูุง ูุฌุงุฒ:**
- `DRAFT` - ูพุดโููุณ
- `SENT` - ุงุฑุณุงู ุดุฏู
- `PAID` - ูพุฑุฏุงุฎุช ุดุฏ
- `OVERDUE` - ูุนูู
- `CANCELLED` - ูุบู ุดุฏ

---

#### 1.6. ุฏุงูููุฏ PDF ูพุดโูุงฺฉุชูุฑ

**Request:**
```
GET http://localhost:3000/api/invoices/{INVOICE_ID}/pdf
Headers:
  Authorization: Bearer {YOUR_JWT_TOKEN}
```

**Response:**
- Content-Type: `application/pdf`
- ูุงู PDF ุจู ุตูุฑุช ูุณุชูู ุฏุงูููุฏ ูโุดูุฏ

**ุชุณุช ุฏุฑ Postman:**
1. Request ุฑุง ุงุฑุณุงู ฺฉูุฏ
2. ุฏุฑ Responseุ ุฑู "Send and Download" ฺฉูฺฉ ฺฉูุฏ
3. ูุงู PDF ุฑุง ุฐุฎุฑู ฺฉูุฏ
4. ูุงู ุฑุง ุจุงุฒ ฺฉูุฏ ู ูุญุชูุง ุฑุง ุจุฑุฑุณ ฺฉูุฏ

---

#### 1.7. ุญุฐู ูพุดโูุงฺฉุชูุฑ

**Request:**
```
DELETE http://localhost:3000/api/invoices/{INVOICE_ID}
Headers:
  Authorization: Bearer {YOUR_JWT_TOKEN}
```

**Response (ูููู):**
```json
{
  "success": true,
  "message": "ูพุดโูุงฺฉุชูุฑ ุจุง ููููุช ุญุฐู ุดุฏ.",
  "data": null
}
```

---

### ูุฑุญูู 2: ุชุณุช ุงุฒ ุทุฑู UI (ุจุนุฏ ุงุฒ ุชฺฉูู ูุฑุงูุชโุงูุฏ)

1. **ูุฑูุฏ ุจู ุณุณุชู**
   - ูุงุฑุฏ ุตูุญู `/auth` ุดูุฏ
   - ุจุง ุดูุงุฑู ููุจุงู ู OTP ูุงุฑุฏ ุดูุฏ

2. **ุฏุณุชุฑุณ ุจู ุตูุญู Invoices**
   - ุงุฒ ููู ุณูุช ุฑุงุณุชุ "ูพุดโูุงฺฉุชูุฑูุง" ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ
   - ุตูุญู `/dashboard/invoices` ุจุงุฒ ูโุดูุฏ

3. **ุงุฌุงุฏ ูพุดโูุงฺฉุชูุฑ ุฌุฏุฏ**
   - ุฑู ุฏฺฉูู "ุงุฌุงุฏ ูพุดโูุงฺฉุชูุฑ ุฌุฏุฏ" ฺฉูฺฉ ฺฉูุฏ
   - ูุฑู ุฑุง ูพุฑ ฺฉูุฏ
   - ูพุดโูุงฺฉุชูุฑ ุฑุง ุฐุฎุฑู ฺฉูุฏ

4. **ูุดุงูุฏู ูุณุช**
   - ูุณุช ูพุดโูุงฺฉุชูุฑูุง ุฑุง ุจุฑุฑุณ ฺฉูุฏ
   - ููุชุฑูุง ุฑุง ุชุณุช ฺฉูุฏ

5. **ุฏุงูููุฏ PDF**
   - ุฑู ฺฉ ูพุดโูุงฺฉุชูุฑ ฺฉูฺฉ ฺฉูุฏ
   - ุฏฺฉูู "ุฏุงูููุฏ PDF" ุฑุง ุจุฒูุฏ
   - ูุงู PDF ุฑุง ุจุฑุฑุณ ฺฉูุฏ

---

## ๐ ุจุฑุฑุณ ุฎุทุงูุง

### ุฎุทุงูุง ุฑุงุฌ:

1. **401 Unauthorized**
   - ูุดฺฉู: ุชูฺฉู JWT ูุนุชุจุฑ ูุณุช ุง ูููุถ ุดุฏู
   - ุฑุงูโุญู: ุฏูุจุงุฑู ูุงุฑุฏ ุดูุฏ ู ุชูฺฉู ุฌุฏุฏ ุฏุฑุงูุช ฺฉูุฏ

2. **404 Not Found**
   - ูุดฺฉู: ุดูุงุณู ูพุดโูุงฺฉุชูุฑ ุง ูุดุชุฑ ูุนุชุจุฑ ูุณุช
   - ุฑุงูโุญู: ุงุฒ ุดูุงุณูโูุง ูุนุชุจุฑ ุงุณุชูุงุฏู ฺฉูุฏ

3. **422 Validation Error**
   - ูุดฺฉู: ุฏุงุฏูโูุง ุงุฑุณุงู ูุนุชุจุฑ ูุณุชูุฏ
   - ุฑุงูโุญู: ููุฏูุง ุงุฌุจุงุฑ ุฑุง ูพุฑ ฺฉูุฏ ู ูุฑูุชโูุง ุฑุง ุจุฑุฑุณ ฺฉูุฏ

4. **500 Internal Server Error**
   - ูุดฺฉู: ุฎุทุง ุณุฑูุฑ
   - ุฑุงูโุญู: ูุงฺฏโูุง ุณุฑูุฑ ุฑุง ุจุฑุฑุณ ฺฉูุฏ

---

## ๐ ฺฺฉโูุณุช ุชุณุช

- [ ] ุงุฌุงุฏ ูพุดโูุงฺฉุชูุฑ ุจุง ููููุช
- [ ] ูุญุงุณุจู ุฎูุฏฺฉุงุฑ ูุจุงูุบ (subtotal, tax, grandTotal)
- [ ] ุฏุฑุงูุช ูุณุช ูพุดโูุงฺฉุชูุฑูุง
- [ ] ููุชุฑ ุจุฑ ุงุณุงุณ ูุถุนุช
- [ ] ููุชุฑ ุจุฑ ุงุณุงุณ ูุดุชุฑ
- [ ] ููุชุฑ ุจุฑ ุงุณุงุณ ุจุงุฒุงุฑุงุจ
- [ ] ููุชุฑ ุจุฑ ุงุณุงุณ ุชุงุฑุฎ
- [ ] Pagination
- [ ] ุฏุฑุงูุช ุฌุฒุฆุงุช ูพุดโูุงฺฉุชูุฑ
- [ ] ุจูโุฑูุฒุฑุณุงู ูพุดโูุงฺฉุชูุฑ
- [ ] ุชุบุฑ ูุถุนุช ูพุดโูุงฺฉุชูุฑ
- [ ] ุฏุงูููุฏ PDF
- [ ] ุญุฐู ูพุดโูุงฺฉุชูุฑ
- [ ] Validation ุฎุทุงูุง
- [ ] Authentication ุฎุทุงูุง

---

## ๐ ูุฑุงุญู ุจุนุฏ

ุจุนุฏ ุงุฒ ุชุณุช ูููู API:
1. ุชฺฉูู ูุฑุงูุชโุงูุฏ (ุงุชุตุงู UI ุจู API)
2. ุงูุฒูุฏู ูุฑู ุงุฌุงุฏ/ูุฑุงุด ูพุดโูุงฺฉุชูุฑ
3. ุงูุฒูุฏู Pagination ุฏุฑ UI
4. ุงูุฒูุฏู ููุชุฑูุง ุฏุฑ UI
5. ุงูุฒูุฏู ุฏฺฉูู ุฏุงูููุฏ PDF

---

**ุขุฎุฑู ุจูโุฑูุฒุฑุณุงู:** ฑดฐด/ฐธ/ฒถ

