# ฺฏุฒุงุฑุด ูุถุนุช PWA ู ุณุทุญ ุฏุณุชุฑุณโูุง (RBAC) โ ุจูโุฑูุฒุฑุณุงู

## ๐ฑ ูุถุนุช PWA (Progressive Web App)

### โ ฺฉุงุฑูุง ุงูุฌุงู ุดุฏู
- [x] ูุชุบุฑูุง ูุญุท PWA ุฏุฑ `.env.example` ุชุนุฑู ุดุฏู
  - `NEXT_PUBLIC_PWA_NAME=TamirBan`
  - `NEXT_PUBLIC_PWA_SHORT_NAME=TamirBan`
  - `NEXT_PUBLIC_PWA_DESCRIPTION=TamirBan CRM Progressive Web App`
- [x] ุฏุฑ `explaination.md` ุฐฺฉุฑ ุดุฏู ฺฉู ุจุงุฏ PWA ุจุงุดุฏ (ุฎุท 7 ู 11)
- [x] ูุนูุงุฑ Next.js ุขูุงุฏู ุจุฑุง PWA ุงุณุช
- [x] ุฏุฑ `todo.md` ูุงุฒ 9 ุจุฑุง PWA ุชุนุฑู ุดุฏู (ุงูููุช ุจุงูุง โ 2-3 ุฑูุฒ)

### โ ฺฉุงุฑูุง ุจุงูโูุงูุฏู (ุงูููุช ุจุงูุง)
- [ ] ุงุฌุงุฏ ูุงู `public/manifest.json` ุจุง ุชูุธูุงุช PWA
  - [ ] ูุงู ุงูพูฺฉุดู
  - [ ] ุขฺฉููโูุง (ูุฎุชูู ุณุงุฒูุง: 192x192, 512x512)
  - [ ] ุฑูฺฏ ุชู
  - [ ] ุญุงูุช ููุงุด (standalone, fullscreen)
  - [ ] ุดุฑูุน URL (`/dashboard`)
- [ ] ุงุฌุงุฏ Service Worker (`public/sw.js` ุง `public/service-worker.js`)
  - [ ] Cache ฺฉุฑุฏู ูุงูโูุง ุงุณุชุงุชฺฉ (CSS, JS, Images)
  - [ ] Cache ฺฉุฑุฏู API responses (ุงุฎุชุงุฑ)
  - [ ] Offline support (ุตูุญู Offline)
  - [ ] Background sync (ุงุฎุชุงุฑ)
  - [ ] Push notifications (ุงุฎุชุงุฑ)
- [ ] ุซุจุช Service Worker ุฏุฑ `app/layout.tsx`
- [ ] ุงุชุตุงู manifest.json ุจู `app/layout.tsx`
- [ ] ุงุฌุงุฏ ุขฺฉููโูุง PWA ุฏุฑ ุณุงุฒูุง ูุฎุชูู (192x192, 512x512)
- [ ] ุชุณุช ูุตุจ PWA ุฑู ููุจุงู (Android Chrome, iOS Safari)
- [ ] ุชุณุช Offline mode
- [ ] ุชุณุช ุจูโุฑูุฒุฑุณุงู ุฎูุฏฺฉุงุฑ

### ๐ ุฒูุงูโุจูุฏ ูพุดููุงุฏ
**ูุงุฒ PWA: 2-3 ุฑูุฒ**
- ุฑูุฒ 1: ุงุฌุงุฏ manifest.json ู ุขฺฉููโูุง
- ุฑูุฒ 2: ูพุงุฏูโุณุงุฒ Service Worker
- ุฑูุฒ 3: ุชุณุช ู ุจูููโุณุงุฒ

### ๐ก ูุฒุงุง PWA ุจุฑุง ุงู ูพุฑูฺู
1. **ฺฉ ฺฉุฏ ุจุฑุง ูุจ ู ููุจุงู**: ูุงุฒ ุจู ุงูพูฺฉุดู ุฌุฏุงฺฏุงูู ูุณุช
2. **ูุตุจ ุณุฑุน**: ฺฉุงุฑุจุฑุงู ูโุชูุงููุฏ ุงุฒ ูุฑูุฑฺฏุฑ ูุตุจ ฺฉููุฏ
3. **ุจูโุฑูุฒุฑุณุงู ุฎูุฏฺฉุงุฑ**: ุชุบุฑุงุช ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ุงุนูุงู ูโุดูุฏ
4. **Offline Support**: ุงูฺฉุงู ุงุณุชูุงุฏู ุจุฏูู ุงูุชุฑูุช
5. **ุจุนุฏุงู ูโุชูุงู ุจู Native App ุชุจุฏู ฺฉุฑุฏ**: ุจุง ุงุณุชูุงุฏู ุงุฒ Capacitor ุง TWA

---

## ๐ ูุถุนุช RBAC (Role-Based Access Control)

### โ ฺฉุงุฑูุง ุงูุฌุงู ุดุฏู (Backend โ 80% ุชฺฉูู)
- [x] ุชุนุฑู ููุดโูุง ุฏุฑ `lib/types/domain.ts`:
  - `SUPER_ADMIN` โ ูุฏุฑ ฺฉู
  - `FINANCE_MANAGER` โ ูุฏุฑ ูุงู
  - `MARKETER` โ ุจุงุฒุงุฑุงุจ
  - `CUSTOMER` โ ูุดุชุฑ
- [x] ุชุนุฑู Permissions ุจุฑุง ูุฑ ููุด ุฏุฑ `lib/middleware/rbac.ts`:
  - **SUPER_ADMIN**: ุฏุณุชุฑุณ ฺฉุงูู (users, customers, visits, invoices, marketers, reports, settings)
  - **FINANCE_MANAGER**: ููุท ุฎูุงูุฏู ูุดุชุฑุงูุ ุฎูุงูุฏู/ููุดุชู ูพุดโูุงฺฉุชูุฑูุงุ ุฎูุงูุฏู ฺฏุฒุงุฑุดโูุง
  - **MARKETER**: ุฎูุงูุฏู/ููุดุชู ูุดุชุฑุงูุ ุฎูุงูุฏู/ููุดุชู ูุฒุชโูุงุ ุฎูุงูุฏู/ููุดุชู ูพุดโูุงฺฉุชูุฑูุง
  - **CUSTOMER**: ููุท ุฎูุงูุฏู ุงุทูุงุนุงุช ุฎูุฏ (ูุดุชุฑุงูุ ูพุดโูุงฺฉุชูุฑูุง)
- [x] Middleware `requireRole()` ุจุฑุง ุจุฑุฑุณ ููุด
- [x] Middleware `requirePermission()` ุจุฑุง ุจุฑุฑุณ permission
- [x] ุชุงุจุน `checkPermission()` ุจุฑุง ุจุฑุฑุณ ุฏุณุชุฑุณ
- [x] ุงุณุชูุงุฏู ุงุฒ RBAC ุฏุฑ ุจุฑุฎ API Routes (ุงุญุฑุงุฒ ููุช)

### โ๏ธ ฺฉุงุฑูุง ูุงูุต (ุงูููุช ุจุงูุง)

#### 1. ูุญุฏูุฏุณุงุฒ ุฏุณุชุฑุณ ุงุฏูู ุงุตู (0% ุชฺฉูู)
- [ ] ุฌููฺฏุฑ ุงุฒ ุชุบุฑ ููุด ุฎูุฏ ุงุฏูู ุงุตู
- [ ] ุฌููฺฏุฑ ุงุฒ ุบุฑูุนุงู ฺฉุฑุฏู ุญุณุงุจ ุฎูุฏ ุงุฏูู ุงุตู
- [ ] ุงูุฒูุฏู ุจุฑุฑุณ ุฏุฑ `updateMarketer` ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุชุบุฑ ููุด ุงุฏูู ุงุตู
- [ ] ุงูุฒูุฏู ุจุฑุฑุณ ุฏุฑ `updateMarketer` ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุบุฑูุนุงู ฺฉุฑุฏู ุงุฏูู ุงุตู
- [ ] ููุงุด ูพุงู ููุงุณุจ ุจู ฺฉุงุฑุจุฑ ุฏุฑ ุตูุฑุช ุชูุงุด ุจุฑุง ุชุบุฑ ุบุฑูุฌุงุฒ

#### 2. ุงุนูุงู RBAC ุฏุฑ Frontend (UI) โ 0% ุชฺฉูู
- [ ] ุงุฌุงุฏ Hook `usePermissions()` ุฏุฑ `lib/hooks/use-permissions.ts`
- [ ] ุงุฌุงุฏ ฺฉุงููพูููุช `ProtectedComponent` ุฏุฑ `components/common/protected-component.tsx`
- [ ] ูุฎู ฺฉุฑุฏู ุฏฺฉููโูุง ุจุฑ ุงุณุงุณ ููุด:
  - [ ] ุฏฺฉูู "ุงูุฒูุฏู ูุดุชุฑ" ููุท ุจุฑุง MARKETER ู SUPER_ADMIN
  - [ ] ุฏฺฉูู "ุงูุฒูุฏู ุจุงุฒุงุฑุงุจ" ููุท ุจุฑุง SUPER_ADMIN
  - [ ] ุชุจ "ุชูุธูุงุช" ููุท ุจุฑุง SUPER_ADMIN
  - [ ] ุฏฺฉูู "ุญุฐู" ููุท ุจุฑุง SUPER_ADMIN
  - [ ] ุฏฺฉูู "ูุฑุงุด ูพุดโูุงฺฉุชูุฑ" ููุท ุจุฑุง FINANCE_MANAGER ู SUPER_ADMIN
- [ ] ูุฎู ฺฉุฑุฏู ููู Sidebar ุจุฑ ุงุณุงุณ ููุด
- [ ] ููุงุด ูพุงู "ุฏุณุชุฑุณ ูุฏุงุฑุฏ" ุฏุฑ ุตูุฑุช ุชูุงุด ุจุฑุง ุฏุณุชุฑุณ ุบุฑูุฌุงุฒ

#### 3. ุงุนูุงู RBAC ุฏุฑ API Routes (ุชฺฉูู) โ 30% ุชฺฉูู
- [ ] ุจุฑุฑุณ ุชูุงู API Routes ู ุงูุฒูุฏู `requireRole()` ุง `requirePermission()`
- [ ] ูุญุงูุธุช ุงุฒ `/api/customers` ุจุง `requirePermission("customers:write")`
- [ ] ูุญุงูุธุช ุงุฒ `/api/marketers` ุจุง `requireRole("SUPER_ADMIN")`
- [ ] ูุญุงูุธุช ุงุฒ `/api/invoices` ุจุง `requirePermission("invoices:write")`
- [ ] ูุญุงูุธุช ุงุฒ `/api/visits` ุจุง `requirePermission("visits:write")`
- [ ] ูุญุงูุธุช ุงุฒ `/api/settings` ุจุง `requireRole("SUPER_ADMIN")`
- [ ] ูุญุงูุธุช ุงุฒ `/api/reports` ุจุง `requirePermission("reports:read")`

#### 4. ุตูุญู ูุฏุฑุช ููุดโูุง โ 0% ุชฺฉูู
- [ ] ุงุฌุงุฏ ุตูุญู `/dashboard/settings/roles` ุจุฑุง ูุฏุฑุช ููุดโูุง
- [ ] ููุงุด ูุณุช ููุดโูุง ู permissions
- [ ] ุงูฺฉุงู ุงุฌุงุฏ ููุด ุฌุฏุฏ (ููุท SUPER_ADMIN)
- [ ] ุงูฺฉุงู ูุฑุงุด permissions ููุดโูุง (ููุท SUPER_ADMIN)
- [ ] ููุงุด ฺฉุงุฑุจุฑุงู ูุฑ ููุด

### ๐ ุฒูุงูโุจูุฏ ูพุดููุงุฏ
**ูุงุฒ RBAC ุชฺฉูู: 3-4 ุฑูุฒ**
- ุฑูุฒ 1: ูุญุฏูุฏุณุงุฒ ุฏุณุชุฑุณ ุงุฏูู ุงุตู + ุงุนูุงู RBAC ุฏุฑ API Routes
- ุฑูุฒ 2: ุงุฌุงุฏ Hook ู ฺฉุงููพูููุชโูุง Frontend ุจุฑุง RBAC
- ุฑูุฒ 3: ูุฎู ฺฉุฑุฏู UI ุจุฑ ุงุณุงุณ ููุด
- ุฑูุฒ 4: ุตูุญู ูุฏุฑุช ููุดโูุง + ุชุณุช

---

## ๐ ุฎูุงุตู ูุถุนุช

| ููุฑุฏ | ูุถุนุช | ุฏุฑุตุฏ ุชฺฉูู | ุงูููุช | ูุงุฒ ุฏุฑ todo.md |
|------|-------|------------|--------|----------------|
| **PWA** | โ ูพุงุฏูโุณุงุฒ ูุดุฏู | 10% | ุจุงูุง | ูุงุฒ 9 (2-3 ุฑูุฒ) |
| **RBAC Backend** | โ ูพุงุฏูโุณุงุฒ ุดุฏู | 80% | ุจุงูุง | ูุงุฒ 10 (3-4 ุฑูุฒ) |
| **RBAC Frontend** | โ ูพุงุฏูโุณุงุฒ ูุดุฏู | 0% | ุจุงูุง | ูุงุฒ 10 (3-4 ุฑูุฒ) |
| **ูุญุฏูุฏุณุงุฒ ุงุฏูู** | โ ูพุงุฏูโุณุงุฒ ูุดุฏู | 0% | ุจุงูุง | ูุงุฒ 10 (3-4 ุฑูุฒ) |

---

## ๐ฏ ุชูุตู ูุณุฑ ูพุดุฑู

### ูุฑุญูู 1: ุชฺฉูู RBAC (ุงูููุช ููุฑ) โ 3-4 ุฑูุฒ
**ฺุฑุง ุงููุ** ุงููุช ุณุณุชู ุฏุฑ ุงูููุช ุงุณุช ู ุจุงุฏ ูุจู ุงุฒ PWA ุชฺฉูู ุดูุฏ.

1. **ุฑูุฒ 1**: ูุญุฏูุฏุณุงุฒ ุฏุณุชุฑุณ ุงุฏูู ุงุตู + ุงุนูุงู RBAC ุฏุฑ ุชูุงู API Routes
2. **ุฑูุฒ 2**: ุงุฌุงุฏ Hook `usePermissions()` ู ฺฉุงููพูููุช `ProtectedComponent`
3. **ุฑูุฒ 3**: ูุฎู ฺฉุฑุฏู UI ุจุฑ ุงุณุงุณ ููุด (ุฏฺฉููโูุงุ ููููุง)
4. **ุฑูุฒ 4**: ุตูุญู ูุฏุฑุช ููุดโูุง + ุชุณุช ฺฉุงูู

### ูุฑุญูู 2: ูพุงุฏูโุณุงุฒ PWA (ุงูููุช ุจุงูุง) โ 2-3 ุฑูุฒ
**ฺุฑุง ุจุนุฏ ุงุฒ RBACุ** PWA ุจุฑุง ุชุฌุฑุจู ฺฉุงุฑุจุฑ ุจูุชุฑ ุงุณุชุ ุงูุง ุงููุช ุงูููุช ุฏุงุฑุฏ.

1. **ุฑูุฒ 1**: ุงุฌุงุฏ manifest.json ู ุขฺฉููโูุง
2. **ุฑูุฒ 2**: ูพุงุฏูโุณุงุฒ Service Worker
3. **ุฑูุฒ 3**: ุชุณุช ูุตุจ ู Offline mode

### ูุฑุญูู 3: ุชุณุช ู ุจูููโุณุงุฒ โ 1-2 ุฑูุฒ
1. ุชุณุช RBAC ุจุง ููุดโูุง ูุฎุชูู
2. ุชุณุช PWA ุฑู ููุจุงู
3. ุจูููโุณุงุฒ ุนููฺฉุฑุฏ

---

## ๐ ูฺฉุงุช ููู

1. **PWA ุจูุชุฑ ุงุฒ ุงูพูฺฉุดู ุฌุฏุงฺฏุงูู ุงุณุช** ุจุฑุง ุดุฑูุนุ ฺูู:
   - ฺฉ ฺฉุฏ ุจุฑุง ูุจ ู ููุจุงู
   - ูุตุจ ุณุฑุนโุชุฑ
   - ุจูโุฑูุฒุฑุณุงู ุฎูุฏฺฉุงุฑ
   - ุจุนุฏุงู ูโุชูุงู ุจู Native App ุชุจุฏู ฺฉุฑุฏ (ุจุง Capacitor ุง TWA)

2. **RBAC ุจุงุฏ ุฏุฑ Frontend ู Backend ุงุนูุงู ุดูุฏ**:
   - Backend: ุงููุช ุงุตู (ุฌููฺฏุฑ ุงุฒ ุฏุณุชุฑุณ ุบุฑูุฌุงุฒ)
   - Frontend: ุชุฌุฑุจู ฺฉุงุฑุจุฑ ุจูุชุฑ (ูุฎู ฺฉุฑุฏู ุฏฺฉููโูุง ุบุฑูุฌุงุฒ)

3. **ูุญุฏูุฏุณุงุฒ ุงุฏูู ุงุตู** ุจุฑุง ุฌููฺฏุฑ ุงุฒ ููู ุดุฏู ุณุณุชู ุถุฑูุฑ ุงุณุช:
   - ุงุฏูู ุงุตู ูุจุงุฏ ุจุชูุงูุฏ ููุด ุฎูุฏ ุฑุง ุชุบุฑ ุฏูุฏ
   - ุงุฏูู ุงุตู ูุจุงุฏ ุจุชูุงูุฏ ุญุณุงุจ ุฎูุฏ ุฑุง ุบุฑูุนุงู ฺฉูุฏ

4. **ุทุจู ุชูุถุญุงุช ุงููู** (`explaination.md`):
   - ููุดโูุง: ูุฏุฑ ฺฉูุ ูุฏุฑ ูุงูุ ุจุงุฒุงุฑุงุจุ ูุดุชุฑ โ
   - ุงูฺฉุงู ุชูุธู ุฏุณุชุฑุณโูุง ุงุฎุชุตุงุต โ (Backend ูพุงุฏู ุดุฏู)
   - ูุนุงู/ุบุฑูุนุงู ฺฉุฑุฏู ฺฉุงุฑุจุฑุงู โ (ุฏุฑ ูุงฺูู Marketers)

---

## ๐ ูุฑุงุฌุน

- `explaination.md` โ ุฎุท 7: "ูุจโุงูพ/PWA ู ูพูู ูุฏุฑุช"
- `explaination.md` โ ุฎุท 11: "ูพุดุชุจุงู ุงุฒ PWA"
- `explaination.md` โ ุฎุท 20: "ูุฏุฑุช ููุดโูุง: ูุฏุฑ ฺฉูุ ูุฏุฑ ูุงูุ ุจุงุฒุงุฑุงุจุ ูุดุชุฑ"
- `todo.md` โ ูุงุฒ 9: ูพุงุฏูโุณุงุฒ PWA
- `todo.md` โ ูุงุฒ 10: ุชฺฉูู RBAC
- `lib/middleware/rbac.ts` โ ูพุงุฏูโุณุงุฒ Backend RBAC
